<!DOCTYPE html>
<html>
<head>
    <title>Inha University Map</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=fbfc80086b51f57d3116c771cb190a3a&libraries=services"></script>
    <script>
        function initMap() {
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                mapOption = {
                    center: new kakao.maps.LatLng(37.450701, 126.657157), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };

            var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

            // 경로 찾기
            var directionsService = new kakao.maps.services.Directions();

            document.getElementById('searchRoute').onclick = function() {
                // HTML5의 geolocation으로 사용할 수 있는지 확인합니다
                if (navigator.geolocation) {
                    
                    // GeoLocation을 이용해서 접속 위치를 얻어옵니다
                    navigator.geolocation.getCurrentPosition(function(position) {
                        
                        var lat = position.coords.latitude, // 위도
                            lon = position.coords.longitude; // 경도
                        
                        var startLatLng = new kakao.maps.LatLng(lat, lon); // 현재 위치를 출발지로 설정

                        var endSelect = document.getElementById('end');
                        var endLatLng = new kakao.maps.LatLng(endSelect.options[endSelect.selectedIndex].value.split(',')[0], endSelect.options[endSelect.selectedIndex].value.split(',')[1]);
                        
                        directionsService.route({
                            origin: startLatLng,
                            destination: endLatLng,
                        }, function(response, status) {
                            if (status === kakao.maps.services.Status.OK) {
                                var path = response.routes[0].overview_path;
                                var linePath = [];

                                for (var i = 0; i < path.length; i++) {
                                    linePath.push(new kakao.maps.LatLng(path[i].lat(), path[i].lng()));
                                }

                                var polyline = new kakao.maps.Polyline({
                                    path: linePath,
                                    strokeWeight: 5,
                                    strokeColor: 'blue',
                                    strokeOpacity: 0.7
                                });

                                polyline.setMap(map);

                                // 시작점 마커 추가
                                var startMarker = new kakao.maps.Marker({
                                    map: map,
                                    position: startLatLng
                                });

                                // 끝점 마커 추가
                                var endMarker = new kakao.maps.Marker({
                                    map: map,
                                    position: endLatLng
                                });
                            }
                        });
                    });

                } else { // HTML5의 GeoLocation을 사용할 수 없을 때의 처리
                    alert("이 브라우저에서는 Geolocation이 지원되지 않습니다.");
                }
            }
        }

        window.onload = initMap;
    </script>
</head>
<body>
    <h1>Inha University Map</h1>
    <div id="map" style="width:100%;height:350px;"></div>
    <div id="search">
        목적지: <select id="end">
            <option value="37.4496269,126.6544458">본관</option>
            <option value="37.4510162,126.655597">2호관</option>
            <option value="37.45082, 126.6542">60주년 기념관</option>
            <option value="37.45037, 126.6552">4호관</option>
            <option value="37.45117, 126.6532">5호관</option>
            <option value="37.4477242, 126.6558786">6호관</option>
            <option value="37.4496216, 126.6565310">학생회관</option>
            <option value="37.4397122,126.6633494">정석학술정보관</option>
            <option value="37.4475290, 126.6552470">9호관</option>
            <option value="37.4515845, 126.6507610">서호관</option>
            <option value="37.4515963, 126.6507088">나빌레관</option>
            <option value="37.4507484, 126.6570103">하이테크센터</option>
            <option value="37.4483567, 126.6520531">로스쿨관</option>
            <option value="37.4472782, 126.6538485">정문</option>
            <option value="37.4511724, 126.6563103">후문</option>
        </select>
        <button id="searchRoute">경로 찾기</button>
    </div>
</body>
</html>
